{"version":3,"sources":["hooks/useAccessibility.ts"],"names":["useAccessibility","behavior","options","actionHandlers","debugName","mapPropsToBehavior","rtl","definition","latestDefinition","React","useRef","slotHandlers","slotProps","current","getA11yProps","slotName","userProps","hasKeyDownHandlers","Boolean","keyHandlers","onKeyDown","e","accessibilityHandler","userHandler","args","finalProps","attributes","unstable_wrapWithFocusZone","element","focusZone","child","process","env","NODE_ENV","Children","only","createElement","FocusZone","props","as","type","isRtl"],"mappings":"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","sourcesContent":["import { Accessibility, AccessibilityAttributesBySlot } from '@fluentui/accessibility';\nimport * as React from 'react';\n\nimport getAccessibility from '../accessibility/getAccessibility';\nimport { AccessibilityActionHandlers, KeyboardEventHandler, ReactAccessibilityBehavior } from '../accessibility/types';\nimport FocusZone from '../FocusZone/FocusZone';\nimport useIsomorphicLayoutEffect from './useIsomorphicLayoutEffect';\n\ntype UseAccessibilityOptions<Props> = {\n  actionHandlers?: AccessibilityActionHandlers;\n  debugName?: string;\n  mapPropsToBehavior?: () => Props;\n  rtl?: boolean;\n};\n\ntype UseAccessibilityResult = (<SlotProps extends Record<string, any> & UserProps>(\n  slotName: string,\n  slotProps: SlotProps,\n) => MergedProps<SlotProps>) & {\n  unstable_wrapWithFocusZone: (children: React.ReactElement) => React.ReactElement;\n};\n\ntype UserProps = {\n  onKeyDown?: KeyboardEventHandler;\n};\n\ntype MergedProps<SlotProps extends Record<string, any> = any> = SlotProps &\n  Partial<AccessibilityAttributesBySlot> &\n  UserProps;\n\nconst useAccessibility = <Props>(behavior: Accessibility<Props>, options: UseAccessibilityOptions<Props> = {}) => {\n  const { actionHandlers, debugName = 'Undefined', mapPropsToBehavior = () => ({}), rtl = false } = options;\n\n  const definition = getAccessibility(debugName, behavior, mapPropsToBehavior(), rtl, actionHandlers);\n\n  const latestDefinition = React.useRef<ReactAccessibilityBehavior>();\n  const slotHandlers = React.useRef<Record<string, KeyboardEventHandler>>({});\n  const slotProps = React.useRef<Record<string, UserProps>>({});\n\n  useIsomorphicLayoutEffect(() => {\n    latestDefinition.current = definition;\n  });\n\n  const getA11yProps: UseAccessibilityResult = (slotName, userProps) => {\n    const hasKeyDownHandlers = Boolean(definition.keyHandlers[slotName] || userProps.onKeyDown);\n    slotProps.current[slotName] = userProps;\n\n    // We want to avoid adding event handlers until it's really needed\n    if (hasKeyDownHandlers) {\n      if (!slotHandlers.current[slotName]) {\n        slotHandlers.current[slotName] = (e, ...args) => {\n          const accessibilityHandler = latestDefinition.current?.keyHandlers[slotName]?.onKeyDown;\n          const userHandler = slotProps.current[slotName].onKeyDown;\n\n          if (accessibilityHandler) accessibilityHandler(e);\n          if (userHandler) userHandler(e, ...args);\n        };\n      }\n    } else {\n      delete slotHandlers.current[slotName];\n    }\n\n    const finalProps: MergedProps = {\n      ...definition.attributes[slotName],\n      ...userProps,\n      onKeyDown: slotHandlers.current[slotName],\n    };\n\n    return finalProps;\n  };\n\n  // Provides an experimental handling for FocusZone definition in behaviors\n  getA11yProps.unstable_wrapWithFocusZone = (element: React.ReactElement) => {\n    if (definition.focusZone) {\n      let child: React.ReactElement = element;\n\n      if (process.env.NODE_ENV !== 'production') {\n        child = React.Children.only(element);\n      }\n\n      return React.createElement(FocusZone, {\n        ...definition.focusZone.props,\n        ...child.props,\n        as: child.type,\n        isRtl: rtl,\n      });\n    }\n\n    return element;\n  };\n\n  return getA11yProps;\n};\n\nexport default useAccessibility;\n"],"file":"useAccessibility.js"}